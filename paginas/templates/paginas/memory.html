{% extends 'paginas/base.html' %}
{% load static i18n %}

{% block title %}
  <title>{% trans "Jogo da Mem√≥ria - CodeHub" %}</title>
{% endblock %}

{% block main %}
<style>
  * {
    box-sizing: border-box;
  }

  .memory-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start; /* puxar mais pra esquerda */
    padding: 16px;
    margin: 0 auto;
    max-width: 360px;
  }

  .memory-container h2 {
    text-align: center;
    width: 100%;
  }

  .memory-game {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    width: 100%;
  }

  .card {
    background-color: transparent;
    width: 100%;
    aspect-ratio: 1 / 1;
    position: relative;
    perspective: 600px;
    cursor: pointer;
  }

  .card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transition: transform 0.5s ease;
    transform-style: preserve-3d;
  }

  .card.flipped .card-inner {
    transform: rotateY(180deg);
  }

  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 6px;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: white;
  }

  .card-front {
    background-color: #007bff;
  }

  .card-back {
    background-color: #28a745;
    transform: rotateY(180deg);
  }

  .win-message {
    margin-top: 20px;
    font-weight: bold;
    color: green;
  }

  .buttons {
    margin-top: 16px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  button {
    padding: 10px 16px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    background-color: #007bff;
    color: white;
    cursor: pointer;
  }

  button:hover {
    background-color: #0056b3;
  }

  @media (max-width: 400px) {
    .memory-game {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>

<div class="memory-container">
  <h2>{% trans "Jogo da Mem√≥ria" %}</h2>
  <div class="memory-game" id="game"></div>
  <div class="win-message" id="winMessage"></div>
  <div class="buttons">
    <button onclick="restartGame()">{% trans "Reiniciar" %}</button>
    <button id="playAgainBtn" style="display:none;" onclick="restartGame()">{% trans "Jogar Novamente" %}</button>
  </div>
</div>

<script>
  const symbolsBase = ['üê±', 'üê∂', 'üê∞', 'üê∏'];
  let symbols = [];
  let cards = [];
  let flippedCards = [];
  let matched = 0;

  const game = document.getElementById('game');
  const winMessage = document.getElementById('winMessage');
  const playAgainBtn = document.getElementById('playAgainBtn');

  function setupGame() {
    game.innerHTML = '';
    winMessage.textContent = '';
    playAgainBtn.style.display = 'none';
    flippedCards = [];
    matched = 0;
    symbols = [...symbolsBase, ...symbolsBase];
    cards = symbols.sort(() => Math.random() - 0.5);

    cards.forEach(symbol => {
      const card = document.createElement('div');
      card.classList.add('card');
      card.innerHTML = `
        <div class="card-inner">
          <div class="card-front">?</div>
          <div class="card-back">${symbol}</div>
        </div>
      `;
      game.appendChild(card);

      card.addEventListener('click', () => {
        if (card.classList.contains('flipped') || flippedCards.length === 2) return;

        card.classList.add('flipped');
        flippedCards.push({ card, symbol });

        if (flippedCards.length === 2) {
          const [first, second] = flippedCards;
          if (first.symbol === second.symbol) {
            matched++;
            flippedCards = [];
            if (matched === symbolsBase.length) {
              winMessage.textContent = 'üéâ {% trans "Voc√™ venceu!" %}';
              playAgainBtn.style.display = 'inline-block';
            }
          } else {
            setTimeout(() => {
              first.card.classList.remove('flipped');
              second.card.classList.remove('flipped');
              flippedCards = [];
            }, 800);
          }
        }
      });
    });
  }

  function restartGame() {
    setupGame();
  }

  setupGame();
</script>
{% endblock %}